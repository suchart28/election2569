<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Khon Kaen Election Live Score - 11 Constituencies</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; font-family: 'Sarabun', sans-serif; }
        .constituency-header { background: #003366; color: white; padding: 15px; border-radius: 10px 10px 0 0; }
        .candidate-card { border: none; border-bottom: 1px solid #eee; padding: 10px; transition: 0.2s; }
        .candidate-card:hover { background-color: #f1f8ff; }
        .vote-count { font-size: 1.2rem; font-weight: bold; color: #0056b3; }
        .rank-1 { border-left: 5px solid gold; }
    </style>
</head>
<body>

<div class="container py-5">
    <div class="text-center mb-5">
        <h1 class="fw-bold">ผลคะแนนเลือกตั้ง จังหวัดขอนแก่น</h1>
        <span class="badge bg-primary">ทั้งหมด 11 เขตเลือกตั้ง</span>
    </div>

    <div class="row g-4" id="dashboard">
        </div>
</div>

<script>
async function loadKhonKaenData() {
    try {
        // ดึงข้อมูลผู้สมัครและคะแนน (ขอนแก่น id: 40)
        const [resCan, resScore] = await Promise.all([
            fetch('candidate_constituency.json').then(r => r.json()),
            fetch('https://static-ectreport69.ect.go.th/data/data/result/result_province_40.json').then(r => r.json())
        ]);

        const container = document.getElementById('dashboard');
        
        // วนลูปสร้าง Dashboard ทั้ง 11 เขต
        for (let i = 1; i <= 11; i++) {
            const consData = resCan.filter(c => c.prov_id == "40" && c.cons_no == i);
            const scores = resScore.mp_constituency_result.filter(s => s.cons_no == i);

            // รวมข้อมูลผู้สมัครกับคะแนน
            const merged = consData.map(c => {
                const score = scores.find(s => s.candidate_id == c.id);
                return { ...c, vote_count: score ? score.vote_count : 0 };
            }).sort((a, b) => b.vote_count - a.vote_count);

            renderConstituency(i, merged, container);
        }
    } catch (e) {
        console.error("Error:", e);
    }
}

function renderConstituency(no, candidates, container) {
    let html = `
        <div class="col-lg-4 col-md-6">
            <div class="card shadow-sm border-0 h-100">
                <div class="constituency-header">
                    <h5 class="mb-0">เขตเลือกตั้งที่ ${no}</h5>
                </div>
                <div class="card-body p-0">
                    ${candidates.slice(0, 3).map((can, idx) => `
                        <div class="candidate-card ${idx === 0 ? 'rank-1' : ''}">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <small class="text-muted">${can.party_name}</small>
                                    <div class="fw-bold">${can.name}</div>
                                </div>
                                <div class="text-end">
                                    <div class="vote-count">${can.vote_count.toLocaleString()}</div>
                                    <small class="text-muted">คะแนน</small>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                <div class="card-footer bg-white border-0 text-center">
                    <small class="text-primary cursor-pointer">ดูผู้สมัครทั้งหมดในเขตนี้</small>
                </div>
            </div>
        </div>
    `;
    container.innerHTML += html;
}

loadKhonKaenData();
</script>
</body>
</html>
