<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Election Live Score Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root { --primary-color: #003366; --accent-color: #ffcc00; }
        body { background-color: #f4f7f6; font-family: 'Sarabun', sans-serif; }
        .score-card { border-radius: 15px; border: none; transition: 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .party-logo { width: 50px; height: 50px; object-fit: contain; background: #eee; border-radius: 50%; }
        .winner-tag { position: absolute; top: -10px; right: -10px; background: gold; padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 12px; }
        .progress { height: 10px; border-radius: 5px; }
    </style>
</head>
<body>

<div class="container py-4">
    <div class="header-section text-center mb-5 p-5 bg-dark text-white rounded-4 shadow">
        <h1 class="display-5 fw-bold">‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á ‡∏™‡∏™. ‡∏£‡∏≤‡∏¢‡πÄ‡∏Ç‡∏ï</h1>
        <p class="lead">‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏î‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ó‡∏µ‡πà‡∏ä‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ï‡∏±‡πâ‡∏á</p>
    </div>

    <div class="row g-3 mb-4 sticky-top bg-light p-3 rounded-3 shadow-sm">
        <div class="col-md-5">
            <select id="provinceFilter" class="form-select form-select-lg" onchange="filterData()">
                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
            </select>
        </div>
        <div class="col-md-5">
            <input type="text" id="searchInput" class="form-select-lg form-control" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£ ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏£‡∏£‡∏Ñ...">
        </div>
        <div class="col-md-2 text-end">
            <button class="btn btn-primary btn-lg w-100" onclick="location.reload()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
        </div>
    </div>

    <div id="loading" class="text-center py-5">
        <div class="spinner-border text-primary" role="status"></div>
        <p class="mt-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô...</p>
    </div>

    <div class="row g-4" id="scoreGrid">
        </div>
</div>

<script>
// ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£ Mapping ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏à‡∏£‡∏¥‡∏á‡∏Ñ‡∏ß‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å JSON)
let candidates = []; 
let votes = []; 

async function loadElectionData() {
    try {
        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£
        const resCan = await fetch('candidate_constituency.json');
        candidates = await resCan.json();
        
        // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏ü‡∏•‡πå ‡πÉ‡∏´‡πâ mock ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á)
        // const resVote = await fetch('result_constituency.json');
        // votes = await resVote.json();

        populateProvinces();
        renderResults();
        document.getElementById('loading').classList.add('d-none');
    } catch (e) {
        console.error("Data Load Error:", e);
        // ‡πÅ‡∏™‡∏î‡∏á Mock Data ‡∏ñ‡πâ‡∏≤‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏´‡πá‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏≤ Dashboard
        mockResults();
    }
}

function renderResults(filterProv = '', searchTerm = '') {
    const grid = document.getElementById('scoreGrid');
    grid.innerHTML = '';

    // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    let displayList = candidates.filter(c => {
        const matchProv = !filterProv || c.prov_name === filterProv;
        const matchSearch = !searchTerm || c.name.includes(searchTerm) || c.party_name.includes(searchTerm);
        return matchProv && matchSearch;
    });

    // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏à‡∏≤‡∏Å‡∏°‡∏≤‡∏Å‡πÑ‡∏õ‡∏ô‡πâ‡∏≠‡∏¢ (‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡πÉ‡∏ô JSON ‡∏°‡∏µ‡∏ü‡∏¥‡∏•‡∏î‡πå vote_count)
    displayList.sort((a, b) => (b.vote_count || 0) - (a.vote_count || 0));

    displayList.slice(0, 50).forEach((can, index) => {
        const card = `
            <div class="col-md-6 col-lg-4">
                <div class="card score-card p-3 position-relative bg-white h-100">
                    ${index === 0 ? '<span class="winner-tag text-dark shadow-sm">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö 1</span>' : ''}
                    <div class="d-flex align-items-center mb-3">
                        <div class="flex-shrink-0">
                            <div class="party-logo d-flex align-items-center justify-content-center fw-bold text-muted border">
                                ${can.party_name[0]}
                            </div>
                        </div>
                        <div class="ms-3">
                            <h6 class="mb-0 text-primary fw-bold">${can.party_name}</h6>
                            <h5 class="mb-0">${can.name}</h5>
                            <small class="text-muted">‡πÄ‡∏Ç‡∏ï ${can.cons_no} | ${can.prov_name}</small>
                        </div>
                    </div>
                    <div class="mt-auto">
                        <div class="d-flex justify-content-between mb-1">
                            <span class="small fw-bold">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°</span>
                            <span class="text-primary fw-bold">${(can.vote_count || 0).toLocaleString()}</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-success" style="width: ${Math.random() * 100}%"></div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        grid.innerHTML += card;
    });
}

function populateProvinces() {
    const provs = [...new Set(candidates.map(c => c.prov_name))].sort();
    const select = document.getElementById('provinceFilter');
    provs.forEach(p => select.innerHTML += `<option value="${p}">${p}</option>`);
}

function filterData() {
    const prov = document.getElementById('provinceFilter').value;
    const search = document.getElementById('searchInput').value;
    renderResults(prov, search);
}

// ‡∏£‡∏∞‡∏ö‡∏ö Search ‡πÅ‡∏ö‡∏ö Real-time
document.getElementById('searchInput').addEventListener('input', filterData);

loadElectionData();
</script>
</body>
</html>
